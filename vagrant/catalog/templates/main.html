<!DOCTYPE html>
<html lang="en">
	<head>
		<link href='http://fonts.googleapis.com/css?family=Roboto:400,300,700' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
		<link rel=stylesheet type=text/css href="{{ url_for('static', filename='styles.css') }}">
		<script src="https://use.fontawesome.com/02630fc401.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<!--LOAD PRE-REQUISITES FOR GOOGLE SIGN IN -->
		  <script src="//apis.google.com/js/platform.js?onload=start"> </script>
		<!-- END PRE-REQUISITES FOR GOOGLE SIGN IN -->
	</head>
	<body>
		{% include "header.html" %}
		<div class="container">
			{% if route_name %}
			  <h1 class="text-center">
			    {{route_name}}
					{{state}}
			  </h1>
			{% endif %}
			<div class = 'flash'>
					      {% with messages = get_flashed_messages() %}
			      {% if messages %}

			        <ul>
			        {% for message in messages %}
			            <li> <strong> {{ message }} </strong> </li>
			        {% endfor %}
			        </ul>
			        {% endif %}
			    {% endwith %}
			</div>
			<div class="jumbotron jumbotron-fluid">
		    <div class="px-3">
					{% block content %}
					{% endblock %}
				</div>
			</div>
		</div>

		{% include "login_modal.html" %}


		<script>
		  function signInCallback(authResult) {
		    if (authResult['code']) {
		      console.log('authResult', authResult['code'])
		      // Send the one time use code to the server. if the server responses, write a login successful message and redirect
					$('#signinButton').attr('style', 'display: none;')
		      $.ajax({
		        type: 'POST',
		        url: '/gconnect?state={{STATE}}',
		        processData: false,
		        contentType: 'application/text; charset=utf-8',
		        data: authResult['code'],
		        success: function(result) {
		          if (result) {
		            $('#result').html('Login Successful!</br>' + result + '</br>Redirecting...')
		            setTimeout(function() {
									$('#login_modal').modal('hide')
		              window.location.reload();
		            }, 4000)
		          } else if (authResult['error']) {
		            console.log("There was an error: " + authResult['error']);
		          }
		        },
		        error:function (xhr, ajaxOptions, thrownError){
		          if(xhr.status==404) {
		            $('#result').html("Failed to make a server-side call.</br>Check your configuration and console.")
		          }
		        }
		      })
		    } else {
		      $('#result').html("Failed to make a server-side call.</br>Check your configuration and console.")
		    }
		  }
		</script>


		<script>
		// Example starter JavaScript for disabling form submissions if there are invalid fields
		(function() {
		  'use strict';

		  window.addEventListener('load', function() {
		    var form = document.getElementById('needs-validation');
				if (form) {
			    form.addEventListener('submit', function(event) {
			      if (form.checkValidity() === false) {
			        event.preventDefault();
			        event.stopPropagation();
			      }
			      form.classList.add('was-validated');
			    }, false);
				}
		  }, false);
		})();
		</script>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
	</body>
</html>
